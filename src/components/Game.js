// src/components/Game.js
export function startGame(container) {
  container.innerHTML = `
    <div class="game-screen">
      <div id="story-text" class="story-text"></div>
      <div id="choices" class="choices"></div>
    </div>
  `;

  const story = createStory();
  let currentStep = 0;

  function renderStep() {
    const step = story[currentStep];
    if (!step) return;

    const storyText = container.querySelector('#story-text');
    const choicesDiv = container.querySelector('#choices');

    storyText.innerHTML = step.text || '';
    choicesDiv.innerHTML = '';

    if (step.choices && step.choices.length) {
      step.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerHTML = choice.label;
        btn.addEventListener('click', () => {
          currentStep = choice.next;
          renderStep();
          saveProgress();
        });
        choicesDiv.appendChild(btn);
      });
    }
  }

  function saveProgress() {
    try {
      localStorage.setItem('mellstroy_progress', String(currentStep));
    } catch (e) {}
  }

  function loadProgress() {
    try {
      const saved = localStorage.getItem('mellstroy_progress');
      if (saved !== null) currentStep = parseInt(saved, 10) || 0;
    } catch (e) {}
  }

  container.addEventListener('click', (e) => {
    if (e.target && e.target.id === 'restart-btn') {
      try { localStorage.removeItem('mellstroy_progress'); } catch (err) {}
      currentStep = 0;
      renderStep();
    }
  });

  loadProgress();
  renderStep();
}

function createStory() {
  return [
    { id: 0, text: `<b>üéÆ –≠–ø–∏–∑–æ–¥ 1. –ù–∞—á–∞–ª–æ</b><br><br>–ú–∏–Ω—Å–∫. –ú–∞–ª–µ–Ω—å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞. –°—Ç–∞—Ä—ã–π –Ω–æ—É—Ç–±—É–∫ –∏ –º–µ—á—Ç–∞ ‚Äî —Å—Ç–∞—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–º.<br><br>–ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º?`,
      choices: [
        { label: 'üé• –ù–∞—á–∞—Ç—å —Å—Ç—Ä–∏–º', next: 1 },
        { label: 'üíº –ü–æ–π—Ç–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ–∏—Å', next: 2 }
      ]
    },

    { id: 1, text: `–¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –ø–µ—Ä–≤—ã–π —Å—Ç—Ä–∏–º. –û–¥–∏–Ω –∑—Ä–∏—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: ‚Äú–ö—Ç–æ —Ç—ã –≤–æ–æ–±—â–µ?‚Äù`,
      choices: [
        { label: 'üî• –û—Ç–≤–µ—Ç–∏—Ç—å –¥–µ—Ä–∑–∫–æ', next: 3 },
        { label: 'üòÖ –û—Ç–≤–µ—Ç–∏—Ç—å —Å —à—É—Ç–∫–æ–π', next: 4 }
      ]
    },
    { id: 2, text: `–¢—ã —É—Å—Ç—Ä–æ–∏–ª—Å—è –Ω–∞ –æ–±—ã—á–Ω—É—é —Ä–∞–±–æ—Ç—É. –î–µ–Ω—å –∑–∞ –¥–Ω—ë–º. –ù–æ –≤–Ω—É—Ç—Ä–∏ –≤—Å—ë –≥–æ—Ä–∏—Ç ‚Äî —Ç—ã —Ö–æ—á–µ—à—å –±–æ–ª—å—à–µ–≥–æ.`,
      choices: [
        { label: 'üéÆ –í—Å—ë –±—Ä–æ—Å–∏—Ç—å –∏ —Å—Ç—Ä–∏–º–∏—Ç—å', next: 1 }
      ]
    },

    { id: 3, text: `–î–µ—Ä–∑–∫–∏–π –æ—Ç–≤–µ—Ç —Ä–∞–∑–æ—à—ë–ª—Å—è –ø–æ —Ñ–æ—Ä—É–º–∞–º. –õ—é–¥–∏ –Ω–∞—á–∞–ª–∏ –æ–±—Å—É–∂–¥–∞—Ç—å —Ç–µ–±—è. –ü–µ—Ä–≤—ã–µ 100 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤!`,
      choices: [
        { label: 'üöÄ –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ', next: 5 },
        { label: 'üé≠ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç', next: 6 }
      ]
    },
    { id: 4, text: `–®—É—Ç–∫–∞ –∑–∞—à–ª–∞! –õ—é–¥–∏ —Å–º–µ—é—Ç—Å—è. –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –ª–∞–π—Ç–æ–≤–∞—è ‚Äî —Ä–∞—Å—Ç—ë—à—å –≤ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.`,
      choices: [
        { label: 'üî• –£—Å–∫–æ—Ä–∏—Ç—å—Å—è –∏ —É–¥–∏–≤–∏—Ç—å –≤—Å–µ—Ö', next: 5 }
      ]
    },
    { id: 5, text: `–¢–≤–æ–π —Å—Ç–∏–ª—å —É–∑–Ω–∞–≤–∞–µ–º. –ß–∞—Ç –∞–∫—Ç–∏–≤–µ–Ω. –î–æ–Ω–∞—Ç—ã –ø–æ—à–ª–∏.<br><br>–ù–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ –Ω—É–∂–µ–Ω –ø—Ä–æ—Ä—ã–≤.`,
      choices: [
        { label: 'üìπ –°–¥–µ–ª–∞—Ç—å —Å—É–º–∞—Å—à–µ–¥—à–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç', next: 7 },
        { label: 'üí¨ –û—Ç–∫—Ä—ã—Ç—å –¥—É—à—É –∞—É–¥–∏—Ç–æ—Ä–∏–∏', next: 8 }
      ]
    },
    { id: 6, text: `–¢—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–µ—à—å: IRL, —Ä–æ–∑—ã–≥—Ä—ã—à–∏, –≤—ã–∑–æ–≤—ã. –ê—É–¥–∏—Ç–æ—Ä–∏—è —Ä–∞—Å—Ç—ë—Ç, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äú–æ–≥–Ω—è‚Äù.`,
      choices: [
        { label: 'üî• –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–µ—Ä–∑–æ—Å—Ç–∏', next: 7 },
        { label: 'ü§ù –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏', next: 9 }
      ]
    },
    { id: 7, text: `–ë—É–º! –í–∏–¥–µ–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏—Ä—É—Å–Ω—ã–º. –¢–µ–±—è –∑–Ω–∞—é—Ç –≤—Å–µ. –ù–µ–Ω–∞–≤–∏—Å—Ç—å –∏ –ª—é–±–æ–≤—å ‚Äî –≤ –æ–¥–Ω–æ–º —Ñ–ª–∞–∫–æ–Ω–µ.`,
      choices: [
        { label: '‚ö° –î–µ—Ä–∂–∞—Ç—å —Ç–µ–º–ø', next: 10 },
        { label: 'üß† –°–¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É', next: 11 }
      ]
    },
    { id: 8, text: `–¢—ã –≥–æ–≤–æ—Ä–∏—à—å —á–µ—Å—Ç–Ω–æ –∏ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É. –õ—é–¥–∏ —á—É–≤—Å—Ç–≤—É—é—Ç –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å.`,
      choices: [
        { label: '‚ù§Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–∞–≤–¥–æ–π', next: 12 },
        { label: 'üí• –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —à–æ—É', next: 10 }
      ]
    },
    { id: 9, text: `–°–æ–≤–º–µ—Å—Ç–Ω—ã–π —Å—Ç—Ä–∏–º –≤–∑—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä—ã. –¢—ã –Ω–∞—á–∏–Ω–∞–µ—à—å —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏.`,
      choices: [
        { label: 'üí£ –ó–∞–ø—É—Å–∫ –∫–æ–ª–ª–∞–±-—à–æ—É', next: 13 }
      ]
    },
    { id: 10, text: `–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç. –ü–æ—è–≤–ª—è—é—Ç—Å—è —Ö–µ–π—Ç–µ—Ä—ã, –°–ú–ò, –¥–∞–≤–ª–µ–Ω–∏–µ.`,
      choices: [
        { label: 'üí™ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ', next: 14 },
        { label: 'üßò –£–π—Ç–∏ –Ω–∞ –ø–µ—Ä–µ—Ä—ã–≤', next: 15 }
      ]
    },
    { id: 11, text: `–¢—ã –±–µ—Ä—ë—à—å –ø–∞—É–∑—É. –õ—é–¥–∏ —Å–∫—É—á–∞—é—Ç. –¢–≤–æ–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ–º.`,
      choices: [
        { label: 'üî• –í–µ—Ä–Ω—É—Ç—å—Å—è —Å –Ω–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º', next: 16 }
      ]
    },
    { id: 12, text: `–¢—ã –¥–µ–ª–∏—à—å—Å—è –∏—Å—Ç–æ—Ä–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç. –õ—é–¥–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–±—è –≥–ª—É–±–∂–µ.`,
      choices: [
        { label: 'üöÄ –°–¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–æ–µ —à–æ—É', next: 17 }
      ]
    },
    { id: 13, text: `–®–æ—É —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–º. –õ—é–¥–∏ –∂–¥—É—Ç –∫–∞–∂–¥–æ–≥–æ —ç—Ñ–∏—Ä–∞.`,
      choices: [
        { label: 'üéØ –†–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–æ–µ–∫—Ç', next: 18 }
      ]
    },
    { id: 14, text: `–¢—ã –∏–¥—ë—à—å –≤–ø–µ—Ä—ë–¥, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤—Å—ë. –ù–æ –¥–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ç—ë—Ç.`,
      choices: [
        { label: 'üí£ –í—ã–ø–ª–µ—Å–Ω—É—Ç—å —ç–º–æ—Ü–∏–∏', next: 19 },
        { label: 'üß† –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è', next: 20 }
      ]
    },
    { id: 15, text: `–ü–∞—É–∑–∞ –∑–∞—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —É—Ö–æ–¥—è—Ç, –Ω–æ —Å–∞–º—ã–µ –≤–µ—Ä–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è.`,
      choices: [
        { label: 'üî• –í–µ—Ä–Ω—É—Ç—å—Å—è —Å–∏–ª—å–Ω–µ–µ', next: 16 }
      ]
    },
    { id: 16, text: `–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ! –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è.`,
      choices: [
        { label: 'üí• –°–æ–∑–¥–∞—Ç—å –∫—Ä—É–ø–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ', next: 17 }
      ]
    },
    { id: 17, text: `–¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –º–∞—Å—à—Ç–∞–±–Ω–æ–µ —à–æ—É ‚Äî —ç—Ç–æ —Ö–∏—Ç!`,
      choices: [
        { label: 'üíé –†–∞–∑–≤–∏—Ç—å –±—Ä–µ–Ω–¥', next: 21 }
      ]
    },
    { id: 18, text: `–¢—ã —Å–æ–∑–¥–∞—ë—à—å —Å—Ç—É–¥–∏—é. –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞. –í—Å—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–µ–µ.`,
      choices: [
        { label: 'üìà –î–≤–∏–≥–∞—Ç—å—Å—è –∫ –º–µ—á—Ç–µ', next: 22 }
      ]
    },
    { id: 19, text: `–¢—ã –Ω–µ —Å–¥–µ—Ä–∂–∞–ª—Å—è ‚Äî —Å–∫–∞–Ω–¥–∞–ª. –ù–æ –≤–Ω–∏–º–∞–Ω–∏–µ –≤—ã—Ä–æ—Å–ª–æ –µ—â—ë –±–æ–ª—å—à–µ.`,
      choices: [
        { label: 'üî• –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–∞–π–ø', next: 23 }
      ]
    },
    { id: 20, text: `–¢—ã –∑–∞–∫—Ä—ã–≤–∞–µ—à—å—Å—è –æ—Ç –≤—Å–µ—Ö, –∏—â–µ—à—å —Å–º—ã—Å–ª.`,
      choices: [
        { label: 'üí´ –ü–µ—Ä–µ–æ—Å–º—ã—Å–ª–∏—Ç—å –≤—Å—ë', next: 24 }
      ]
    },
    { id: 21, text: `–¢–≤–æ–π –±—Ä–µ–Ω–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º. –¢—ã –≤–ª–∏—è–µ—à—å –Ω–∞ –∫—É–ª—å—Ç—É—Ä—É.`,
      choices: [
        { label: 'üé∞ –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç', next: 25 }
      ]
    },
    { id: 22, text: `–¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–∏–ª—É –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.`,
      choices: [
        { label: 'üéØ –°–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ –≤–µ–ª–∏–∫–æ–µ', next: 25 }
      ]
    },
    { id: 23, text: `–°–∫–∞–Ω–¥–∞–ª –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ —Ç—Ä–∞–º–ø–ª–∏–Ω. –í—Å–µ –≥–æ–≤–æ—Ä—è—Ç –æ —Ç–µ–±–µ.`,
      choices: [
        { label: 'üíé –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–∏–∑–Ω–µ—Å', next: 25 }
      ]
    },
    { id: 24, text: `–¢–∏—à–∏–Ω–∞ –¥–∞–ª–∞ —Ç–µ–±–µ —è—Å–Ω–æ—Å—Ç—å. –¢–µ–ø–µ—Ä—å —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å, –∫—Ç–æ —Ç—ã.`,
      choices: [
        { label: 'üî• –í–µ—Ä–Ω—É—Ç—å—Å—è –∏ –ø–æ–∫–∞–∑–∞—Ç—å –º–æ—â—å', next: 25 }
      ]
    },
    { id: 25, text: `<b>üé∞ –§–∏–Ω–∞–ª—å–Ω–∞—è –∞—Ä–∫–∞</b><br><br>–¢—ã —Å–æ–∑–¥–∞—ë—à—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Äî <b>MELLSTROY.GAME</b>.<br><br>–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±–∏–∑–Ω–µ—Å. –≠—Ç–æ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ–π —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏: –ø—É—Ç—å, —ç–Ω–µ—Ä–≥–∏—è, –≤—ã–±–æ—Ä—ã, –ª—é–¥–∏.`,
      choices: [
        { label: 'üåü –ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª', next: 26 }
      ]
    },
    { id: 26, text: `–¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –∏–≥—Ä—É –≤ Telegram. –ú–∏–ª–ª–∏–æ–Ω—ã –ª—é–¥–µ–π –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é.<br><br>–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–∂, –∏–¥–µ—è, –±—Ä–µ–Ω–¥.`,
      choices: [
        { label: 'üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—É—Ç—å', next: 27 }
      ]
    },
    { id: 27, text: `<b>üéÆ –ö–æ–Ω–µ—Ü?</b><br><br>–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –ø—Ä–æ–∂–∏–≤–∞–µ—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å. –ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–µ–±—è.<br><br>–¢–∞–∫ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –ª–µ–≥–µ–Ω–¥–∞.<br><br>
      <button id="restart-btn" class="choice-btn">üîÅ –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>`,
      choices: []
    }
  ];
}
